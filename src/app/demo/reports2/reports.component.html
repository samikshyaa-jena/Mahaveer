<!-- <p>Reports Component Works</p> -->
<!--  ----------------------------------------------------------------------------------------  ------------------------------------------------------------------------------------------>
<div class="row">
	<div class="col-md-9 report-heading">
		<!-- <h3>{{ reportType | titlecase}} Transaction Report</h3>  -->
	</div>
	<div class="col-md-3 table-exc-print">
		<!-- <button type="button" class="btn btn-primary"><i class="feather icon-printer"></i> Print</button> -->
		<button type="button" class="btn btn-primary" (click)="downloadExcel()" [attr.disabled]="reports.length ? null : 'disabled'"><i class="feather icon-file"></i> Excel</button>
	</div>
</div>
<app-card [hidHeader]="true">
	<div class="row">
		<div class="col-md-3 order-md-1 order-2">
			<label>Search for any data in the report: </label>
			<div class="input-group searchInput">
				<div class="input-group-prepend"> <span class="input-group-text" id="basic-addon1"> <i class="feather icon-search"></i> </span> </div>
				<input type="text" class="form-control" placeholder="Search" aria-label="Search" aria-describedby="basic-addon1" (keyup)="updateFilter($event)" [formControl]="searchInput"> </div>
		</div>
		<div class="col-md-9 order-md-2 order-1">
			<ng-container [ngSwitch]="reportType">
				<app-recharge-trans-report *ngSwitchCase="'recharge'" (rechargeData)="getFormData($event)"></app-recharge-trans-report>
				<app-dmt-trans-report *ngSwitchCase="'dmt'" (dmtData)="getFormData($event)"></app-dmt-trans-report>
				<app-dmt2-form *ngSwitchCase="'dmt2'" (dmt2Data)="getFormData($event)"></app-dmt2-form>
				<app-aeps-trans-report *ngSwitchCase="'aeps'" (aepsData)="getFormData($event)"></app-aeps-trans-report>
				<app-matm-trans-report *ngSwitchCase="'matm'" (matmData)="getFormData($event)"></app-matm-trans-report>
				<app-bbps-trans-report *ngSwitchCase="'bbps'" (bbpsData)="getFormData($event)"></app-bbps-trans-report>
				<app-ins-trans-report *ngSwitchCase="'insurance'" (insuranceData)="getFormData($event)"></app-ins-trans-report>
				<app-cashout-trans-report *ngSwitchCase="'cashout'" (cashoutData)="getFormData($event)"></app-cashout-trans-report>
				<app-comm-trans-report *ngSwitchCase="'commission'" (commissionData)="getFormData($event)"></app-comm-trans-report>
				<app-wallet-trans-report *ngSwitchCase="'wallet'" (walletData)="getFormData($event)"></app-wallet-trans-report>
				<app-upi-trans-report *ngSwitchCase="'upi'" (upiData)="getFormData($event)"></app-upi-trans-report>
				<app-aadhar-pay *ngSwitchCase="'aadhar'" (adharData)="getFormData($event)"></app-aadhar-pay>
				<app-unified-aeps *ngSwitchCase="'unified'" (unifiedData)="getFormData($event)"></app-unified-aeps>
				<p *ngSwitchDefault>Nothing Works!!</p>
			</ng-container>
		</div>
	</div>
</app-card>
<!--  ----------------------------------------------------------------------------------------  ------------------------------------------------------------------------------------------>
<div class="d-flex justify-content-center" *ngIf="fetchingReport">
	<div class="spinner-border" style="width: 3rem; height: 3rem;" role="status"> <span class="sr-only">Loading...</span> </div>
</div>
<div class="dataTable" *ngIf="!fetchingReport && reports.length">
	<!-- <button (click)="expndall = !expndall" class="btn btn-success float-right mb-2 mr-3">{{expndall ? 'Collapse' : 'Expand'}} All</button>
	<div class="clearfix"></div> -->

	<div *ngIf="reportType === 'dmt2'" class="d-flex flex-row justify-content-end dtBtns">
		<div class="selCols mr-2">
			<!-- <select class="form-control" (change)="showCols($event)">
				<option selected disabled>Select Fields</option>				
				<option value="all">All</option>				
				<option *ngFor="let col of selCols" value="{{col.prop}}">{{col.prop}}</option>
			</select> -->
			<mat-form-field>
				<!-- <mat-label>Favorite food</mat-label> -->
				<mat-select (valueChange)="showCols($event)" multiple>
					<mat-option [value]="'all'">All</mat-option>
				  	<mat-option *ngFor="let col of selCols" [value]="col.prop">{{col.prop}}</mat-option>
				</mat-select>
			  </mat-form-field>
		</div>
		<div class="expBtn">
			<button (click)="expndall = !expndall" class="btn btn-success mb-2 mr-3">{{expndall ? 'Collapse' : 'Expand'}} All</button>
		</div>
	</div>

	<ngx-datatable #table class="material" [headerHeight]="50" [footerHeight]="50" rowHeight="auto" [limit]="10" [rows]="reports" columnMode="force" [scrollbarH]="true" [columns]="tableCols" [rowHeight]="50"> </ngx-datatable>
</div>
<ng-template #checkTemplate let-value="value"> 
	<span *ngIf="['SUCCESS', 'REFUNDED'].includes(value)" class="badge m-r-5 badge-pill badge-success">{{value}}</span> 
	<span *ngIf="['INPROGRESS', 'INITIATED'].includes(value)" class="badge m-r-5 badge-pill badge-warning">{{value}}</span> 
	<span *ngIf="value === 'FAILED'" class="badge m-r-5 badge-pill badge-danger">{{value}}</span>
</ng-template>
<ng-template #gatewayTemplate let-value="value">
	<table *ngIf="expndall">
		<ng-container *ngIf="checkType(value) === 'object'">
			<tr *ngFor="let trdata of value">
				<td>{{trdata.amount}}</td>
				<td>{{trdata.status}}</td>
			</tr>
		</ng-container>
		<ng-container *ngIf="checkType(value) !== 'object'">
			<tr>{{value}}</tr>
		</ng-container>
	</table>
</ng-template>
<ng-template #actionTemplate let-row="row" let-col="column"> 
	<ng-container *ngIf="(reportType === 'dmt2')">
		<ng-template #popContent>
			<div class="mr-2" (click)="actionData(row)">Download</div>
			<div  class="mr-2" (click)="transDetail(row)">Detail</div>
			<div *ngIf="col.prop === 'true'" (click)="showRetries(row)">Retry</div>
		</ng-template>
		<span [placement]="'left'" [ngbPopover]="popContent" class="cursor-pointer"> <i class="feather icon-settings"></i> </span>
	</ng-container>
	<ng-container *ngIf="(reportType !== 'dmt2')">
		<span class="cursor-pointer"> <i class="feather icon-settings"></i> </span>
	</ng-container>
</ng-template>

<ng-template #dateTemplate let-value="value"> <span>{{ value | date: 'medium' }}</span></ng-template>

<ng-template #idTemplate let-value="value" let-row="row"> 
	<span class="cursor-pointer" (click)="showGatewayData(row)"> <b>{{value}}</b> </span>
</ng-template>

<app-ui-modal #modalDefault [hideHeader]="true" dialogClass="modal-lg modal-dialog-centered modal-max-1200">

	<div class="app-modal-body">

		<div class="table-responsive">
			<table class="table table-bordered">
			  <thead>
				<tr>
					<th>ID</th>
					<th>PC</th>
					<th>STATUS</th>
					<th>CREATED DATE</th>
					<th>UPDATED DATE</th>
					<th>TRANSACTION TYPE</th>
					<th>PREVIOUS AMOUNT</th>
					<th>AMOUNT TRANSACTED</th>
					<th>BALANCE AMOUNT</th>
					<th>API COMMENT</th>
				</tr>
			  </thead>
			  <tbody>
				  <ng-container *ngIf="txnDetailReport.reports.length">
					  <tr *ngFor="let report of txnDetailReport.reports">
						  <td>{{report.Id}}</td>
						  <td>{{report.pc}}</td>
						  <td>{{report.status}}</td>
						  <td>{{report.createdDate | date: 'medium'}}</td>
						  <td>{{report.updatedDate | date: 'medium'}}</td>
						  <td>{{report.Type}}</td>
						  <td>{{report.previousAmount}}</td>
						  <td>{{report.amountTransacted}}</td>
						  <td>{{report.balanceAmount}}</td>
						  <td>{{report.apiComment}}</td>
					  </tr>
				  </ng-container>
				  <ng-container *ngIf="!txnDetailReport.reports.length">
					  <tr>
						  <td colspan="10" class="text-center font-weight-bold"> No Records Found </td>
					  </tr>
				  </ng-container>
			  </tbody>
			</table>
		</div>

		<div class="d-flex flex-column align-items-center justify-content-center">
			<button type="button" class="btn btn-danger" (click)="modalDefault.hide()">Cancel</button>
		</div>

	</div>

</app-ui-modal>

<app-ui-modal #modalRetry [hideHeader]="true" dialogClass="modal-dialog-centered">
	<div class="app-modal-body">
		<div class="d-flex justify-content-between mb-3">
			<p class="retry-header">Retry Transactions</p>
			<span class="btnModalClose cursor-pointer" aria-hidden="true" (click)="retryModal.hide()">&times;</span>
		</div>
		<ng-container *ngIf="retryDataDMT2.retrying">
			<div class="d-flex justify-content-center">
				<div class="spinner-border" style="width: 3rem; height: 3rem;" role="status"> <span class="sr-only">Loading...</span> </div>
			</div>
		</ng-container>
		<ng-container *ngIf="!retryDataDMT2.retrying">
			<div *ngIf="retryDataDMT2.transData">
				<div *ngFor="let trans of retryDataDMT2.transData.gateWayData" class="d-flex justify-content-between mb-2">
					<div>{{ trans.id }}</div>
					<div>{{ trans.amount }}</div>
					<div><button type="button" class="btn btn-primary btn-block" (click)="connectThenRetry(trans.id)">Retry</button></div>
				</div>
			</div>
		</ng-container>
	</div>
</app-ui-modal>

<!-- TRANSACTION MODAL STARTS -->
<app-ui-modal #modalSuccess [hideHeader]="true" dialogClass="modal-dialog-centered">
	<div class="app-modal-body">
		<div class="text-right">
			<ng-container *ngIf="!socketData.socket_timeout">
				<span class="cursor-pointer mr-2" (click)="generatePDF()">
				  <img src="assets/images/dmt/download.svg" width="32" />
				</span>
				<!-- <span class="cursor-pointer mr-2">
				  <img src="assets/images/dmt/print.svg" width="32" />
				</span> -->
			</ng-container>
		  <!-- <span class="cursor-pointer mr-3">
			<img src="assets/images/dmt/share.svg" width="32" />
		  </span> -->
			<button type="button" class="close basic-close position-static btnModalClose" data-dismiss="modal" aria-label="Close" (click)="transModal.hide()">
				<span aria-hidden="true">&times;</span>
			</button>
		</div>
	
		<!-- Socket Timeout FALSE Starts -->
		<ng-container *ngIf="!socketData.socket_timeout">
	
		  <!-- Money Transaction Performed Starts -->
		  <ng-container *ngIf="socketData.operation_performed !== 'FN_BENE_VERIFICATION'">
	
			<div class="text-center bank-image">
	  
			  <span class="position-relative DMTStatusImg d-inline-block">
				<!-- <i class="fas fa-university"></i> -->
				<img src="assets/images/dmt/bank.svg" width="100" />
				<ng-container [ngSwitch]="socketData.status">
				  <i *ngSwitchCase="'SUCCESS'" class="far fa-check-circle position-absolute transSuccess"></i>
				  <i *ngSwitchCase="'FAILED'" class="far fa-times-circle position-absolute text-danger"></i>
				  <i *ngSwitchCase="'INPROGRESS'" class="fas fa-exclamation-circle position-absolute text-warning"></i>
				</ng-container>
			  </span>
			  <div class="amount-section-popup mt-2">{{socketData.amount | currency: 'INR'}}</div>
			  <ng-container [ngSwitch]="socketData.status">
				<div *ngSwitchCase="'SUCCESS'" class="mb-3 trans-subheading-popup transSuccess">Money Transfer Successfull</div>
				<div *ngSwitchCase="'FAILED'" class="mb-3 trans-subheading-popup text-danger">Money Transfer Failed</div>
				<div *ngSwitchCase="'INPROGRESS'" class="mb-3 trans-subheading-popup text-warning">Money Transfer is in Progress</div>
			  </ng-container>
			  
			</div>
	
			<div class="container to-from">
			  <div class="row mb-2 px-1">
				<div class="col-6 pl-1">
				  <div class="heading hdngborder">From</div>
				  <div class="from-name mt-2">{{socketData.customer_name}}</div>
				  <div>Mob No.: {{socketData.customer_mobile}}</div>
				</div>
				<div class="col-6 px-0">
				  <div class="heading hdngborder">To</div>
				  <div class="to-name mt-2">{{socketData.bene_name}}</div>
				  <div>A/C No.: {{socketData.bene_acc}}</div>
				  <div>Bank Name: {{socketData.bene_bank}}</div>
				  <div>IFSC: {{socketData.bene_ifsc}}</div>
				</div>
			  </div>
			  <div class="row mb-2 px-1">
				<div class="heading text-uppercase col px-1">Transaction Details</div>
			  </div>
			</div>
	
			<div class="trans-message-dmt">
			  <div class="trans-row">
				 <div class="trans-left">
				   Transaction ID:&nbsp;&nbsp;&nbsp;
				</div>
				<div class="trans-right">
				  {{socketData.id}}
				</div>
			  </div>
			  <div class="trans-row">
				 <div class="trans-left">
				   Transaction Mode:&nbsp;&nbsp;&nbsp;
				</div>
				<div class="trans-right">
				  {{socketData.trans_mode}}
				</div>
			  </div>
			  <div class="trans-row">
				 <div class="trans-left">
				   RRN:&nbsp;&nbsp;&nbsp;
				</div>
				<div class="trans-right">
				  {{socketData.rrn}}
				</div>
			  </div>
			  <div class="trans-row">
				 <div class="trans-left">
				   Status:&nbsp;&nbsp;&nbsp;
				</div>
				<div class="trans-right">
				  {{socketData.status}}
				</div>
			  </div>
			  <div class="trans-row">
				 <div class="trans-left">
				   Shop Name:&nbsp;&nbsp;&nbsp;
				</div>
				<div class="trans-right">
				  {{socketData.shop_name}}
				</div>
			  </div>
			</div>
	
		  </ng-container>
		  <!-- Money Transaction Performed Ends -->
	
		</ng-container>
		<!-- Socket Timeout FALSE Ends -->
	
		
		<!-- Socket Timeout TRUE Starts -->
		<ng-container *ngIf="socketData.socket_timeout">
	
		  <div class="text-center bank-image">
	
			<span class="position-relative DMTStatusImg d-inline-block">
			  <img src="assets/images/dmt/bank.svg" width="100" />
			  <i class="fas fa-exclamation-circle position-absolute text-warning"></i>
			</span>
			<div class="amount-section-popup">{{socketData.amount | currency: 'INR'}}</div>
			<div class="trans-subheading-popup text-warning">Your Money Transfer Is Being Processed!</div>
			
		  </div>
	
		  <div *ngIf="socketData.socket_timeout" class="text-center" style="margin: 12px 0;">
			<div>Your transaction is being processed please check report after some time.</div>
			<small>You will receive an SMS or Notification on completion of transaction.</small>
		  </div>
	  
		  <div class="row trans-buttons mt-2 justify-content-center">
			<div class="col-sm-4">
			  <button type="button" class="btn btn-danger btn-block" (click)="transModal.hide()">OK</button>
			</div>
		  </div>
	
		</ng-container>
		<!-- Socket Timeout TRUE Ends -->
	
	  </div>
</app-ui-modal>
<!-- TRANSACTION MODAL ENDS -->

<app-ui-modal #modalGateway [hideHeader]="true" dialogClass="modal-dialog-centered modal-max-900">
	<div class="app-modal-body">
		<div class="d-flex justify-content-between mb-3">
			<p class="retry-header">Gateway Details</p>
			<span class="btnModalClose cursor-pointer" aria-hidden="true" (click)="modalGateway.hide()">&times;</span>
		</div>
		<div class="table-responsive">
			<table class="table table-bordered">
				<thead>
				<tr>
					<th>ID</th>
					<th>AMOUNT</th>
					<th>RRN</th>
					<th>STATUS</th>
					<th>STATUS DESCRIPTION</th>
					<th>BANK NAME</th>
					<th>STATUS CODE</th>
				</tr>
				</thead>
				<tbody>
					<ng-container *ngIf="checkType(transRecord.gateWayData) === 'object'">
						<tr *ngFor="let data of transRecord.gateWayData">
							<td>{{data.id}}</td>
							<td>{{data.amount}}</td>
							<td>{{data.rrn}}</td>
							<td>{{data.status}}</td>
							<td>{{data.status_desc}}</td>
							<td>{{data.transacted_bank_name}}</td>
							<td>{{data.transaction_status_code}}</td>
						</tr>
					</ng-container>
					<ng-container *ngIf="checkType(transRecord.gateWayData) !== 'object'">
						<tr>
							<td colspan="7" class="text-center font-weight-bold"> {{ transRecord.gateWayData }} </td>
						</tr>
					</ng-container>
				</tbody>
			</table>
		</div>
	</div>
</app-ui-modal>

<ngx-spinner name="reportSpinner"><p style="color: white; margin-top: 50px;" > Fetching Transaction Details... </p></ngx-spinner>