<div *ngIf="loader"
    class="spinner-container spinner-container d-flex position-fixed h-100 justify-content-center align-items-center">
    <div class="d-flex justify-content-center">
        <div class="spinner-border" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
</div>
<button type="button" class="btn back_btn" (click)="previousPage()"><i
        class="fas fa-arrow-alt-circle-left"></i></button>



<div class="card main_cnt mb-3">

    <div style="color: black; font-weight: bold; font-size: 20px; margin-left: -1%;">Manufacture</div>
    <hr style="margin: 1% auto 1.5% -3%; width: 106%;">

    <div class="bar2 mb-4">
        <div class="left_cnt">
            <div class="mr-2">
                <label for="">Product <span class="text-danger">*</span></label><br>
                <input type="text" value="{{rawmatData.prod_name}}" class="mat_name readonly" readonly>
            </div>
            <div>
                <label for="">Quantity <span class="text-danger">*</span></label><br>
                <input type="text" value="{{rawmatData.quantity}}" class="readonly" readonly>
            </div>

        </div>

        <div class="right_cnt">
            <div class="datee">
                <label for="">Expected Date: <span class="text-danger">*</span> &nbsp;</label>
                <input class="readonly" type="text" value="{{rawmatData.expected_time | date: 'dd/MM/yyyy'}}" readonly>
            </div>
        </div>
    </div>

    <div><span style="color: black;">Raw Material &nbsp;</span></div>
    <table class="table">
        <thead>
            <tr>
                <th></th>
                <th>RAW MATERIAL</th>
                <th>Quantity</th>
                <th class="text-right">PRICE</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let data of rawmatData.used_raw_mat_data; let i = index">
                <td class="td_v" style="width: 5%;">{{i + 1}}</td>
                <td class="td_v">{{data.item_name}}</td>
                <td class="td_v">{{data.quantity}}</td>
                <td class="text-right td_v">{{data.mrp}}</td>
            </tr>
        </tbody>
    </table>
    <div class="d-flex justify-content-end align-items-center mb-4"
        style="border: 1px solid lightgray;border-top: none; padding: 5px 10px;">
        <div style="color: black;"><span>TOTAL: &nbsp;</span><span><i
                    class="fas fa-rupee-sign"></i></span><span>{{t_rawmat}}</span></div>
    </div>


    <div><span style="color: black;">Scrap Data &nbsp;</span></div>
    <form [formGroup]="scrapForm">
        <table class="table">
            <thead>
                <tr>
                    <th style="width: 5%;"></th>
                    <th>Scrap</th>
                    <th>Quantity</th>
                    <th class="text-right">UNIT</th>
                    <th class="text-center">Delete</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let data of rawmatData.scrap_data; let i = index">
                    <td class="td_v" style="width: 5%;">{{i + 1}}</td>
                    <td class="td_v">{{data.type}}</td>
                    <td class="td_v">{{data.qty}}</td>
                    <td class="text-right td_v">{{data.unit}}</td>
                    <td class="delete_btn">
                        <button border="none" class="btn disable" disabled><i class="fas fa-times-circle"></i></button>
                    </td>
                </tr>
                <ng-container formArrayName="Scrap">
                    <tr *ngFor="let Product of scrapForm.get('Scrap')['controls'];let i=index" [formGroupName]="i">
                        <td class="td_v">{{i + 1 + rawmatData.scrap_data.length}}</td>
                        <td class="td_e">
                            <input type="text" class="tab_inp readonly" (input)="getSc($event)"
                                formControlName="scrap" autocomplete="off" matInput [matAutocomplete]="auto">


                        </td>
                        <td class="td_e"><input class="tab_inp readonly" type="text" (keypress)="prevent_0($event)"
                                formControlName="qty"></td>
                        <td class="text-right td_e"><input class="tab_inp text-right readonly" type="text"
                                formControlName="unit">
                        </td>
                        <td class="delete_btn">
                            <button border="none" class="btn disable"
                                        (click)="deleteRow(i); totalCalculation()"
                                        [disabled]="scrapForm.get('product').length == 1"><i
                                            class="fas fa-times-circle"></i>
                                            </button>
                        </td>
                    </tr>
                </ng-container>
            </tbody>
        </table>
    </form>
    <div class="d-flex justify-content-between align-items-center mb-4"
        style="border: 1px solid lightgray;border-top: none; padding-right: 10px;">
        <button (click)="add_row()" class="btn disable" border="none" style="color: #07abb0; padding-left: 10px;"
            [disabled]="!edit || scrapForm.get('Scrap')['controls'][scrapForm.get('Scrap')['controls'].length-1].status == 'INVALID'"><span><i
                    class="fas fa-plus"></i>
                &nbsp; &nbsp;</span><span>Add Row</span></button>
        <div class="d-flex align-items-center">
        </div>
    </div>


    <div><span style="color: black;">Consumption Data &nbsp;</span></div>
    <form [formGroup]="consumptionForm">
        <table class="table">
            <thead>
                <tr>
                    <th style="width: 5%;"></th>
                    <th>Consumption</th>
                    <th class="text-right">COST</th>
                    <th class="text-center">Delete</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let data of rawmatData.consumption_data; let i = index">
                    <td class="td_v" style="width: 5%;">{{i + 1}}</td>
                    <td class="td_v">{{data.type}}</td>
                    <td class="text-right td_v">{{data.cost}}</td>
                    <td class="delete_btn">
                        <button border="none" class="btn disable" disabled><i class="fas fa-times-circle"></i>
                                            </button>
                    </td>
                </tr>
                <ng-container formArrayName="Consumption">
                    <tr *ngFor="let Product of consumptionForm.get('Consumption')['controls'];let i=index"
                        [formGroupName]="i">
                        <td class="td_v">{{i + 1 + rawmatData.consumption_data.length}}</td>
                        <td class="td_e">
                            <input type="text" class="tab_inp readonly" (input)="getcn($event)"
                                formControlName="consumption" autocomplete="off"matInput [matAutocomplete]="auto2">

                        </td>
                        <td class="text-right td_e"><input class="tab_inp text-right readonly" type="text"
                                (keypress)="prevent_char($event)"
                                (input)="calc_total(Product.controls); totalCalculation()" formControlName="cost"></td>
                                <td class="delete_btn">
                                    <button border="none" class="btn disable"
                                    (click)="deleteRow(i); totalCalculation()"
                                    [disabled]="consumptionForm.get('product').length == 1"><i
                                        class="fas fa-times-circle"></i>
                                        </button>
                                </td>
                    </tr>
                </ng-container>
            </tbody>
        </table>
    </form>
    <div class="d-flex justify-content-between align-items-center mb-4"
        style="border: 1px solid lightgray;border-top: none; padding-right: 10px;">
        <button (click)="add_row2()" class="btn disable" border="none" style="color: #07abb0; padding-left: 10px;"
            [disabled]="!edit || consumptionForm.get('Consumption')['controls'][consumptionForm.get('Consumption')['controls'].length-1].status == 'INVALID'"><span><i
                    class="fas fa-plus"></i>
                &nbsp; &nbsp;</span><span>Add Row</span></button>
        <div class="d-flex align-items-center">
            
            <div style="color: black;"><span>TOTAL: &nbsp;</span><span><i
                        class="fas fa-rupee-sign"></i></span><span>{{t_cons}}</span></div>
        </div>
    </div>

    <hr style="margin: 1% auto 1.5% -3%; width: 106%; margin-top: 10%;">

    <div class="d-flex justify-content-between align-items-center">
        <div style="border: 1px solid #eedfbe; background: #eedfbe; border-radius: 5px; padding: 0.2% 1%;"><span
                style="color: black;">Total Estimated Cost(Raw Material + Additional Cost) = &nbsp;</span><span><i
                    class="fas fa-rupee-sign"></i></span><span>{{total}}</span></div>
        <div>
            <button class="btn btn-warning mr-2" style="border-radius: 2px;" (click)="previousPage()">Cancel</button>
            <button class="btn btn-primary disable" style="border-radius: 2px;" (click)="addScrap()"
                [disabled]="!edit || scrapForm.get('Scrap')['controls'][scrapForm.get('Scrap')['controls'].length-1].status == 'INVALID' || consumptionForm.get('Consumption')['controls'][consumptionForm.get('Consumption')['controls'].length-1].status == 'INVALID'">Submit</button>
        </div>
    </div>

</div>

<mat-autocomplete #auto="matAutocomplete">
    <mat-option *ngFor="let data of getscrapData" [value]="data.type">
        {{data.type}}
    </mat-option>
</mat-autocomplete>

<mat-autocomplete #auto2="matAutocomplete">
    <mat-option *ngFor="let data of getconsData" [value]="data.type">
        {{data.type}}
    </mat-option>
</mat-autocomplete>