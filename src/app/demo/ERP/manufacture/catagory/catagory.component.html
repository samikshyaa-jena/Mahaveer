<!-- Loader Starts -->
<div *ngIf="loader"
  class="spinner-container spinner-container d-flex position-fixed h-100 w-100 justify-content-center align-items-center">
  <div class="d-flex justify-content-center">
    <div class="spinner-border" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>
</div>
<!-- Loader Ends -->



<div class="container card p-3">
  <!-- show_cat_item 1 starts -->
  <div class="cat_table" *ngIf="show_cat_item == 1">
    <div class="d-flex justify-content-between align-items-center mt-3">
      <div>
        <form [formGroup]="modeForm">
          <button class="btn btn-primary text-white mr-1" style="cursor:not-allowed" title="Manufacture"
            disabled>Manufacture</button>
          <button class="btn btn-primary" routerLink="/v1/trade/category" title="Go To Trade">Trade</button>
        </form>
      </div>
      <div class="add_btn">
        <button class="btn btn-primary mr-1" type="button" (click)="show_cat_item = 5">
          Add Item
        </button>
        <button class="btn btn-primary" (click)="show_cat_item = 2">
          Add Category
        </button>
      </div>
    </div>
    <!-- <div class="card"> -->
    <!-- <div class="card-body card_box"> -->
    <div class="table-responsive glob_tab">
      <div class="flexbox mt-3">
        <div><input type="text" (keyup)="updateFilter($event)" placeholder="search" class="form-control mr-5"></div>
      </div>
      <table class="table v-middle nowrap">
        <thead>
          <tr>
            <th class="border-top-0">Category NAME</th>
            <th class="border-top-0">Item</th>
            <th class="border-top-0">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of cat_data |slice:(page-1)* pageSize:page*pageSize; index as i">
            <td>{{ cat_data[i].cat_name }}</td>
            <td>
              <span style="cursor: pointer" (click)="categoryAction(i)" title="View item"><i class="fas fa-ellipsis-h"
                  aria-hidden="true"></i></span>
            </td>
            <td>
              <span style="cursor: pointer"><i class="fa fa-edit" aria-hidden="true"
                  (click)="cat_edit_popup_open(content, i)"></i>
              </span>
              <span class="mx-2" style="cursor: pointer" (click)="item_delete_popup_open(delete_popup, i)"><i
                  class="fa fa-trash" aria-hidden="true"></i></span>
            </td>
          </tr>
        </tbody>


      </table>
      <div class="flexboxpagination d-flex justify-content-between align-items-center">
        <div>
          <select class="form-control" [(ngModel)]="pageSize">
            <option [ngValue]="5">5 items per page</option>
            <option [ngValue]="10">10 items per page</option>
            <option [ngValue]="15">15 items per page</option>
          </select>
        </div>

        <div *ngIf="cat_data.length > pageSize">
          <ngb-pagination [collectionSize]="collectionSize" [(page)]="page" [maxSize]="5" [pageSize]="pageSize">
          </ngb-pagination>
        </div>

      </div>
    </div>
    <!-- </div> -->
    <!-- </div> -->
  </div>
  <!-- show_cat_item 1 ends -->

  <!-- show_cat_item 2 starts -->
  <div class="add_prod" *ngIf="show_cat_item == 2">
    <!-- <h3 class="mb-3 mt-3" style="color: blue; font-weight: 700;">Manufacture</h3> -->

    <div class="modal_head">
      <div class="modal_body">
        <div class="addCategoryForm">
          <div class="col-sm-12 row mt-3">
            <p style="font-weight: 300;margin-top: 10px;background-color: #F9FAFA;">Add Category</p>
            <hr style="width: 100%;">
          </div>
          <form [formGroup]="addCategoryForm" class="my-3">
            <div class="col-sm-12 row">
              <div class="col-sm-4">
                <input type="text" placeholder="Category Name" class="form-control inp_tag"
                  formControlName="cat_name" />
                <div
                  *ngIf="addCategoryForm.get('cat_name').hasError('required') && addCategoryForm.get('cat_name').touched"
                  class="err-message">
                  <span class="text-danger px-2 my-2">Category can't be blank</span>
                </div>
              </div>
              <div class="col-sm-4"></div>
              <div class="col-sm-4"></div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div class="btns my-3" style="float: right">
      <button class="btn btn-primary mr-1 disable"
        [disabled]="addCategoryForm.invalid || addCategoryForm.value.cat_name.trim() ==''" (click)="add_Category()">
        Add
      </button>
      <button class="btn btn-warning" type="reset" (click)="show_cat_item = 1;addCategoryForm.reset()">
        Cancel
      </button>
    </div>
  </div>
  <!-- show_cat_item 2 ends -->

  <!-- show_cat_item 3 starts -->
  <div class="table-responsive" *ngIf="show_cat_item == 3">
    <h3 class="mb-3 mt-3" style="color: blue; font-weight: 700;">Manufacture</h3>
    <div class="btns my-3" style="float: right">
      <button class="btn btn-warning mr-1" type="reset" (click)="show_cat_item = 1">
        Back
      </button>
      <button class="btn btn-primary" type="button" (click)="show_cat_item = 4">
        Add Item
      </button>
    </div>
    <table class="table v-middle nowrap">
      <thead>
        <tr>
          <th class="border-top-0">Item Name</th>
          <th class="border-top-0">GST</th>
          <th class="border-top-0">HSN</th>
          <th class="border-top-0">Low Stock</th>
          <th class="border-top-0">Unit</th>
          <th class="border-top-0">Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of itemList; let i = index">
          <td>{{ itemList[i].item_name }}</td>
          <td>{{ itemList[i].gst }} %</td>
          <td>{{ itemList[i].hsn }}</td>
          <td>{{ itemList[i].min_stock }}</td>
          <td>{{ itemList[i].unit }}</td>
          <td>
            <span style="cursor: pointer"><i class="fa fa-edit" aria-hidden="true"
                (click)="item_edit_popup_open(content1, i)"></i>
            </span>
            <span class="mx-2" style="cursor: pointer"><i class="fa fa-trash" aria-hidden="true"
                (click)="item_delete_popup_open(delete_popup, i)"></i></span>
          </td>
        </tr>
      </tbody>

    </table>

  </div>
  <!-- show_cat_item 3 ends -->

  <!-- show_cat_item 4&5 starts -->
  <div class="item" *ngIf="show_cat_item == 4 || show_cat_item == 5">
    <div class="form_div" class="my-3">
      <p style="font-weight: 300;">Add Item</p>
      <form [formGroup]="addItemForm" class="my-3">
        <div class="col-sm-12 row">
          <div class="col-sm-4">
            <select class="form-control inp_tag" (change)="addItemCategory($event.target.value)"
              formControlName="category_name">
              <option disabled selected>Choose Category</option>
              <option *ngFor="let data of cat_data" [value]="data.cat_id">
                {{ data.cat_name }}
              </option>
            </select>
          </div>
          <div class="col-sm-4">
            <input type="text" placeholder="Item Name" class="form-control inp_tag" formControlName="item_name" />
          </div>
          <div class="col-sm-4"></div>
        </div>
        <div class="col-sm-12 row">
          <div class="col-sm-4">
            <input type="text" placeholder="HSN" (keypress)="prevent($event)" class="form-control inp_tag"
              formControlName="hsn" />
          </div>
          <div class="col-sm-4">
            <input type="text" placeholder="Unit" class="form-control inp_tag" formControlName="unit" />
          </div>
          <div class="col-sm-4"></div>
        </div>
        <div class="col-sm-12 row">
          <div class="col-sm-4">
            <select name="" id="" formControlName="gst" class="form-control inp_tag">
              <option selected disabled>Select GST</option>
              <option value="0">0 %</option>
              <option value="5">5 %</option>
              <option value="12">12 %</option>
              <option value="18">18 %</option>
              <option value="28">28 %</option>
            </select>
          </div>
          <div class="col-sm-4"></div>
          <div class="col-sm-4"></div>

        </div>
        <div class="col-sm-12 row mt-3">
          <hr style="width: 100%;">
          <p style="font-weight: 300;margin-top: 10px;background-color: #F9FAFA;">Stock</p>
        </div>
        <div class="col-sm-12 row">
          <div class="col-sm-4">
            <input type="text" placeholder="Open Stock" class="form-control inp_tag" formControlName="qty" />
          </div>
          <div class="col-sm-4">
            <input type="text" placeholder="Low Stock" (keypress)="prevent($event)" class="form-control inp_tag"
              formControlName="min_stk" />
          </div>
          <div class="col-sm-4"></div>

        </div>







      </form>
      <!-- <form [formGroup]="addItemForm" class="my-3">
        <table class="table">
          <thead>
            <tr>
                <th>CategoryName: <span class="text-danger">*</span></th>
                <th>Item Name: <span class="text-danger">*</span></th>
                <th>GST: <span class="text-danger">*</span></th>
                <th>Low Stock: <span class="text-danger">*</span></th>
                <th>HSN: <span class="text-danger">*</span></th>
                <th>Unit: <span class="text-danger">*</span></th>
                <th>Open Stock: <span class="text-danger">*</span></th>
            </tr>
        </thead>
        <tbody>
          <td class="td_e">
            <select class="form-control inp_tag" (change)="addItemCategory($event.target.value)"
            formControlName="category_name">
            <option disabled selected>Choose a category</option>
            <option *ngFor="let data of cat_data" [value]="data.cat_id">
              {{ data.cat_name }}
            </option>
          </select>
          </td>
          <td class="td_e">
            <input type="text" class="form-control inp_tag" formControlName="item_name" />
  
          </td>
          <td class="td_e">
            <select name="" id="" formControlName="gst" class="form-control inp_tag">
              <option value="gst" selected disabled>Select gst</option>
              <option value="0">0 %</option>
              <option value="5">5 %</option>
              <option value="12">12 %</option>
              <option value="18">18 %</option>
              <option value="28">28 %</option>
            </select>
          </td>
          <td class="td_e">
            <input type="text" (keypress)="prevent($event)" class="form-control inp_tag" formControlName="min_stk" />
          </td>
          <td class="td_e">
            <input type="text" (keypress)="prevent($event)" class="form-control inp_tag" formControlName="hsn" />
          </td>
          <td class="td_e">
            <input type="text" class="form-control inp_tag" formControlName="unit" />
          </td>
          <td class="td_e">
            <input type="text" class="form-control inp_tag" formControlName="qty" />
          </td>
        </tbody>
        </table>
      </form> -->

    </div>
    <div class="col-sm-12 row btnDiv">
      <button class="btn btn-primary mr-1 my-2" [disabled]="addItemForm.invalid" type="submit" (click)="add_item()">
        Add
      </button>
      <button class="btn btn-warning my-2" type="reset" (click)="show_cat_item = 1;addItemForm.reset()">
        Cancel
      </button>
    </div>
  </div>
  <!-- show_cat_item 4&5 endds -->


</div>




<!-- edit category modal starts -->
<ng-template #content let-c="close" let-d="dismiss">
  <!-- <div class="modal-header">
    <h3 class="mb-3 mt-3 ml-3" style="color: blue; font-weight: 700;">Manufacture</h3>
    <button class="close_btn">
      <i class="fa fa-times-circle" aria-hidden="true" (click)="d('Cross click')"></i>
    </button>
  </div> -->
  <div class="modal-body">
    <div class="updateCatForm">
      <form [formGroup]="updateCatForm" class="my-3">
        <label class="lab_tag" for="">Category Name: <span class="text-danger">*</span></label>
        <input type="text" class="form-control inp_tag" formControlName="cat_name" />
        <div
        *ngIf="updateCatForm.get('cat_name').hasError('required') && updateCatForm.get('cat_name').touched"
        class="err-message">
        <span class="text-danger px-2 my-2">Category can't be blank</span>
      </div>
      </form>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-primary disable" 
    [disabled]="updateCatForm.invalid || updateCatForm.value.cat_name.trim() ==''"
    (click)="edit_Category()">
      Submit
    </button>
    <button type="button" class="btn btn-warning" (click)="cat_edit_popup_close(content)">
      Cancel
    </button>
  </div>
</ng-template>
<!-- edit category modal starts -->

<!-- edit item modal starts -->
<ng-template #content1 let-c="close" let-d="dismiss">
  <!-- <div class="modal-header">
    <h3 class="mb-3 mt-3 ml-3" style="color: blue; font-weight: 700;">Manufacture</h3>
    <button class="close_btn">
      <i class="fa fa-times-circle" aria-hidden="true" (click)="d('Cross click')"></i>
    </button>
  </div> -->
  <div class="modal-body">
    <div class="editItemForm">
      <form [formGroup]="editItemForm" class="my-3">
        <label class="lab_tag" for="">CategoryName: <span class="text-danger">*</span></label>
        <input type="text" class="form-control inp_tag" formControlName="category_name" readonly />
        <label class="lab_tag" for="">Item Name: <span class="text-danger">*</span></label>
        <input type="text" class="form-control inp_tag" formControlName="item_name" />
        <label class="lab_tag" for="">GST: <span class="text-danger">*</span></label>
        <select name="" id="" formControlName="gst" class="form-control inp_tag">
          <option value="gst" selected disabled>Select gst</option>
          <option value="0">0 %</option>
          <option value="5">5 %</option>
          <option value="12">12 %</option>
          <option value="18">18 %</option>
          <option value="28">28 %</option>
        </select>
        <label class="lab_tag" for="">Low Stock: <span class="text-danger">*</span></label>
        <input type="text" (keypress)="prevent($event)" class="form-control inp_tag" formControlName="min_stk" />
        <label class="lab_tag" for="">HSN: <span class="text-danger">*</span></label>
        <input type="text" (keypress)="prevent($event)" class="form-control inp_tag" formControlName="hsn" />
        <label class="lab_tag" for="">Unit: <span class="text-danger">*</span></label>
        <input type="text" class="form-control inp_tag" formControlName="unit" />
        <!-- <label class="lab_tag" for="">Open Stock:</label>
                <input type="text" class="form-control inp_tag" formControlName="qty"> -->
      </form>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-primary" (click)="edit_item()">
      Submit
    </button>
    <button type="button" class="btn btn-warning" (click)="item_edit_popup_close(content1)">
      Cancel
    </button>
  </div>
</ng-template>
<!-- edit item modal starts -->

<ng-template #delete_popup let-c="close" let-d="dismiss">
  <div class="modal-body">
    <p style="font-size: 18px;">Are you sure you want to delete the item ?</p>
  </div>
  <div class="modal-footer">
    <button border="none" (click)="deletePopup(delete_popup)" class="btn btn-primary mr-2">Cancel</button>
    <button border="none" (click)="del_Category();deletePopup(delete_popup)" class="btn btn-warning" *ngIf="show_cat_item == 1">Delete</button>
    <button border="none" (click)="del_item();deletePopup(delete_popup)" class="btn btn-warning"
      *ngIf="show_cat_item == 3">Delete</button>
  </div>
</ng-template>
<!-- <div class="mymodal1" *ngIf="delete_popup == true">
  <div class="mymodal_cnt">
    <p class="my-3">Are you sure you want to delete the item ?</p>
      <div class="modal_btn">
        <button border="none" (click)="del_Category()" class="btn btn-primary mr-2" *ngIf="show_cat_item == 1">Delete</button>
        <button border="none" (click)="del_item()" class="btn btn-primary mr-2" *ngIf="show_cat_item == 3">Delete</button>
        <button border="none" (click)="delete_popup=false" class="btn btn-primary">Cancel</button>
    </div>
  </div>
</div> -->