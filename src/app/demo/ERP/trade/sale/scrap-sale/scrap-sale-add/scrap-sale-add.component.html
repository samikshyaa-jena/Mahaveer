<button type="button" class="btn back_btn mt-3" (click)="previousPage()"><i
        class="fas fa-arrow-alt-circle-left"></i></button>


<div class="card main_cnt mb-3">

    <div class="main_heading">Scrap Sales Entry</div>
    <hr style="margin: 1% auto 1.5% -3%; width: 106%;">
    <form [formGroup]="purchase_form">
        <div class="col-sm-12 px-0 d-flex flex-row">
            <div class="col-sm-3 pl-0">
                <label for="">Invoice Number <span class="text-danger">*</span></label>
                <input type="text" formControlName="invo" class="form-control field_height" readonly="true">
            </div>
            <div class="col-sm-2 pl-0">
                <label for="">Customer Name <span class="text-danger">*</span></label>
                <select class="form-control field_height" formControlName="custmer"
                    (ngModelChange)="vendorType($event); resetProductForm()">
                    <option value="choose_cname" disabled>Choose</option>
                    <option [value]="vendor.customer_id" *ngFor="let vendor of getVendorData">{{vendor.name}}
                    </option>
                </select>

            </div>
            <div class="col-sm-2">
                <label for="">Purchase Date <span class="text-danger">*</span></label>
                <input name="dateRange" [owlDateTimeTrigger]="dt1" [owlDateTime]="dt1" formControlName="p_date"
                    class="form-control field_height" [max]="today" readonly="true" placeholder="YYYY-MM-DD">
                <owl-date-time [pickerType]="'calendar'" #dt1></owl-date-time>
            </div>
            <div class="col-sm-2 ">
                <label for="">Payment Status <span class="text-danger">*</span></label>
                <select formControlName="payStatus" class="form-control field_height">
                    <option value="choosepay" disabled>Choose Payment Status</option>
                    <option value="paid">Fully Paid</option>
                    <option value="part_paid">Partial Paid</option>
                    <option value="not_init">Not Initiated</option>
                </select>
            </div>
            <div class="col-sm-2">
                <label for="">Payment Mode <span class="text-danger">*</span></label>
                <select formControlName="payMode" class="form-control field_height">
                    <option value="choosepaymode" disabled>Choose Payment Mode</option>
                    <option value="cash">Cash</option>
                    <!-- <option value="online">Online</option>
                <option value="cheque">Cheque</option>
                <option value="credit">Credit</option> -->
                </select>
            </div>
            <div class="col-sm-1 px-0">
                <label for="">Amount <span class="text-danger">*</span></label>
                <input type="text" formControlName="amnt" class="form-control field_height"
                    [readonly]="purchase_form.value.payStatus !='part_paid'">
            </div>
            <!-- </ng-template> -->
        </div>
    </form>
    <table class="table w-100 mt-5" *ngIf="productformarray.length!=0">
        <thead class="bg-primary">
            <tr>
                <th class="text-white" scope="col">Product Id</th>
                <th class="text-white" scope="col">Item Id</th>
                <th class="text-white" scope="col">IGST</th>
                <th class="text-white" scope="col">CGST</th>
                <th class="text-white" scope="col">SGST</th>
                <th class="text-white" scope="col">HSN</th>
                <th class="text-white" scope="col">Price</th>
                <th class="text-white" scope="col">Quantity</th>
                <th class="text-white" scope="col">Discount</th>
                <th class="text-white" scope="col">Total</th>
                <th class="text-white" scope="col">Action</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let data of duplicateproductformarray;let i=index">

                <td class="td_e">{{data.category}}</td>
                <td class="td_e">{{data.prod_id}}</td>
                <td class="td_e">{{data.igst}}</td>
                <td class="td_e">{{data.cgst}}</td>
                <td class="td_e">{{data.sgst}}</td>
                <td class="td_e">{{data.hsn}}</td>
                <td class="td_e">{{data.price}}</td>
                <td class="td_e">{{data.qty}}</td>
                <td class="td_e">{{data.discount}}</td>
                <td class="td_e">{{data.total}}</td>
                <td class="td_e" (click)="delete(i)"><i class="fa fa-trash" aria-hidden="true"></i></td>
            </tr>

        </tbody>
    </table>
    <!-- <div class="row col-sm-12" *ngIf="productformarray.length!=0">

    <div class="col-sm-12 text-right"><button class="btn btn-success"
            (click)="add_purchase_details()">Submit</button></div>
                    </div> -->

    <!-- </div> -->
    <!-- </div> -->

    <div class="mt-3">
        <form [formGroup]="productForm">
            <table class="table">
                <thead class="bg-white">
                    <tr>
                        <th style="width: 25%;">Product</th>
                        <!-- <th>Item</th> -->
                        <th>Hsn</th>
                        <th>Quantity</th>
                        <th style="white-space: nowrap;">Sale Price</th>
                        <th>Discount</th>
                        <th>CGST</th>
                        <th>SGST</th>
                        <th>IGST</th>
                        <th>Total</th>
                        <th>Delete</th>
                    </tr>

                </thead>
                <tbody>
                    <ng-container formArrayName="product">
                        <tr *ngFor="let Product of productForm.get('product')['controls'];let i=index"
                            [formGroupName]="i">
                            <td class="td_e">
                                <select class="form-control table_input" id="category"
                                    (change)="chooseCategory(Product, $event.target.value); totalCalculation()"
                                    formControlName="category" [disabled]="purchase_form.invalid">
                                    <option selected value="ChooseProduct" disabled>Choose Product</option>
                                    <option class="disable" *ngFor="let category of getCategoryData;let i=index"
                                        [value]="category.prod_id"
                                        [disabled]="purchase_form.invalid || purchase_form.get('custmer').value == 'choose_cname' || purchase_form.get('payStatus').value == 'choosepay' || purchase_form.get('payMode').value == 'choosepaymode'">
                                        {{category.prod_name}}</option>
                                </select>
                            </td>
                            <!-- <td class="td_e">
                            <select class="form-control" id="prod_id" formControlName="prod_id"
                                (change)="chooseItem($event.target.value,i)" [disabled]="purchase_form.invalid">
                                <option selected value="choose">ChooseProduct </option>
                                <option *ngFor="let item of itemData" [value]="item.prod_id">{{item.prod_name}}
                                </option>
                            </select>
                        </td> -->
                            <td class="td_e"><input type="text" formControlName="hsn" class="form-control table_input"
                                    disabled>
                            </td>
                            <td class="td_e"><input type="number" formControlName="qty" id="qty"
                                    class="form-control table_input"
                                    (input)="calc_total(Product.controls); totalCalculation()"
                                    (keypress)="prevent($event, 'qty')" min="1"
                                    [readonly]="Product.controls.category.value == 'ChooseProduct'">
                            </td>
                            <td class="td_e"><input type="number" formControlName="price" id="price"
                                    class="form-control table_input"
                                    [readonly]="Product.controls.category.value == 'ChooseProduct'"></td>
                            <td class="td_e"><input type="number" formControlName="discount"
                                    (keypress)="prevent($event,'dis')" min="0" id="discount"
                                    class="form-control table_input"
                                    (input)="calc_total(Product.controls); totalCalculation()"
                                    [readonly]="Product.controls.category.value == 'ChooseProduct'"></td>
                            <td class="td_e"><input type="number" formControlName="cgst"
                                    class="form-control table_input" disabled>
                            </td>
                            <td class="td_e"><input type="number" formControlName="sgst"
                                    class="form-control table_input" disabled>
                            </td>
                            <td class="td_e"><input type="number" formControlName="igst"
                                    class="form-control table_input" disabled>
                            </td>
                            <td class="td_e"><input type="number" formControlName="total"
                                    class="form-control table_input" readonly>
                            </td>
                            <!-- <td class="td_e">
                            <button border="none" class="btn btn-primary disable" (click)="submitArray(i)"
                                [disabled]="i.invalid"><i class="fas fa-check"></i></button>
                        </td> -->
                            <td class="delete_btn">
                                <button border="none" class="btn text-danger disable"
                                    (click)="deleteRow(i); totalCalculation()"
                                    [disabled]="productForm.get('product').length == 1"><i
                                        class="fas fa-times-circle"></i></button>
                            </td>
                        </tr>
                    </ng-container>
                </tbody>
                <tfoot>
                    <tr style="border: 1px solid lightgray;">
                        <td colspan="2" style="white-space: nowrap; float: left; padding: 2px; border: 0;"><button
                                class="btn text-info disable" (click)="add_row()"
                                [disabled]="productForm.get('product')['controls'][productForm.get('product')['controls'].length-1].value.category == 'ChooseProduct'">
                                <span><i class="fas fa-plus"></i>&nbsp; &nbsp;</span><span>Add Row</span>
                            </button>
                        </td>
                    </tr>
                </tfoot>

            </table>

        </form>
    </div>



    <div class="total_cal mb-4">
        <table style="width: 290px; color: black;">
            <tr>
                <th style="width: 120px;"></th>
                <th style="width: 50px;"></th>
                <th style="width: 120px;"></th>
            </tr>
            <tr>
                <td>Total IGST</td>
                <td>:</td>
                <td><input name="t_igst" [(ngModel)]="t_igst" class="total_cal_field" type="text" readonly></td>
            </tr>
            <tr>
                <td>Total SGST</td>
                <td>:</td>
                <td><input name="t_sgst" [(ngModel)]="t_sgst" class="total_cal_field" type="text" readonly></td>
            </tr>
            <tr>
                <td>Total CGST</td>
                <td>:</td>
                <td><input name="t_cgst" [(ngModel)]="t_cgst" class="total_cal_field" type="text" readonly></td>
            </tr>
            <tr>
                <td>Total Amount</td>
                <td>:</td>
                <td><input name="t_amount" [(ngModel)]="t_amount" class="total_cal_field" type="text" readonly></td>
            </tr>
        </table>
    </div>

    <hr style="margin: 1% auto 1.5% -3%; width: 106%; margin-top: 10%;">

    <div class="footer_btn">
        <button class="btn btn-warning mr-2" (click)="resetProductForm(); previousPage()">Cancel</button>
        <button class="btn btn-primary disable" (click)="add_purchase_details()"
            [disabled]="productForm.get('product')['controls'][productForm.get('product')['controls'].length-1].value.category == 'ChooseProduct'">Submit</button>
    </div>

</div>





<!-- <div id="myModal2" class="modal2" *ngIf="openmodal">

<div class="card">
    <div class="card-header text-warning text-right"><span (click)="openmodal=false"
            style="cursor: pointer;">X</span>
    </div>
    <div class="card-body">
        <form [formGroup]="productForm">
            <div class="row">
                <div class="col"> 
                    <label>Choose Product</label>
                    <select class="form-control" (change)="chooseCategory($event.target.value)"
                        formControlName="category">
                        <option selected value="choose">ChooseCategory</option>
                        <option *ngFor="let category of getCategoryData;let i=index" [value]="category.cat_id">
                            {{category.cat_name}}</option>
                    </select>
                </div>
                <div class="col">
                    <label>Item</label>
                    <select class="form-control" formControlName="prod_id"
                        (change)="chooseItem($event.target.value)">
                        <option selected value="choose">ChooseProduct </option>
                        <option *ngFor="let item of itemData" [value]="item.prod_id">{{item.prod_name}}</option>
                    </select>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col">
                    <label>IGST</label>
                    <input type="number" formControlName="igst" class="form-control" disabled>
                </div>
                <div class="col">
                    <label>CGST</label>
                    <input type="number" formControlName="cgst" class="form-control" disabled>
                </div>
                <div class="col">
                    <label>SGST</label>
                    <input type="number" formControlName="sgst" class="form-control" disabled>
                </div>
                <div class="col">
                    <label>Hsn</label>
                    <input type="text" formControlName="hsn" class="form-control" disabled>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col">
                    <label>Sale Price</label>
                    <input type="number" formControlName="price" class="form-control" (input)="calc_total()">
                </div>
                <div class="col">
                    <label>Quantity</label>
                    <input type="number" formControlName="qty" class="form-control" (input)="calc_total()">
                </div>
                <div class="col">
                    <label>Discount</label>
                    <input type="number" formControlName="discount" class="form-control" (input)="calc_total()">
                </div>
                <div class="col">
                    <label>Total</label>
                    <input type="number" formControlName="total" class="form-control" readonly>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-sm-12 text-right ">
                    <button type="button" class="btn btn-warning" (click)="submitArray();openmodal=false"
                        [disabled]="productForm.invalid">Submit</button>
                </div>
            </div>
        </form>
    </div>
</div>
</div> -->
<!-- Loader Starts -->
<div *ngIf="loader"
    class="spinner-container spinner-container d-flex position-fixed h-100 w-100 justify-content-center align-items-center">
    <div class="d-flex justify-content-center">
        <div class="spinner-border" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
</div>
<!-- Loader Ends -->